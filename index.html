<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET Core Architecture Flow</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            securityLevel: 'loose',
            fontFamily: 'Inter'
        });
    </script>
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">ASP.NET Core <span>Architecture</span></h1>
            <ul class="nav-links">
                <li><a href="#routing">Routing</a></li>
                <li><a href="#binding">Binding</a></li>
                <li><a href="#validation">Validation</a></li>
            </ul>
        </div>
    </nav>

    <header class="hero">
        <div class="container">
            <h2>Request Life Cycle</h2>
            <p>Visualizing the flow from JavaScript clients to ASP.NET Core Web API.</p>
        </div>
    </header>

    <main class="container">
        <!-- Routing Section -->
        <section id="routing" class="diagram-section">
            <div class="section-header">
                <h3>1. Routing Flow (Flowchart)</h3>
                <p>Hệ thống quyết định "đi đâu" khi nhận được một URL.</p>
            </div>
            <div class="card-grid">
                <div class="card glass">
                    <div class="mermaid">
                        flowchart TD
                        Start([Start: Nhận URL Request]) --> Step1{"1. Attribute Routing?"}

                        Step1 -- "Có [Route]" --> Step2["2. So khớp Attribute trên Controller/Action"]
                        Step1 -- "Không có" --> Step3["3. Kiểm tra Conventional Routing Templates"]

                        Step2 --> Step4{"4. Kiểm tra Constraints"}
                        Step3 --> Step4

                        Step4 -- "id:int (Hợp lệ)" --> Step5["5. Tìm thấy Endpoint: Match"]
                        Step4 -- "Không khớp" --> Step6([6. 404 Not Found])

                        Step5 --> End([Thực thi Action Method])

                        style Start fill:#3b82f6,color:#fff
                        style Step6 fill:#ef4444,color:#fff
                        style End fill:#10b981,color:#fff
                        style Step1 fill:#f59e0b,color:#fff
                        style Step4 fill:#f59e0b,color:#fff
                    </div>
                </div>
                <div class="explanation-card glass">
                    <h4>Chi tiết quy trình:</h4>
                    <ol>
                        <li><strong>Kiểm tra Attribute Routing:</strong> Ưu tiên các định nghĩa URL ngay trên
                            Controller.</li>
                        <li><strong>Conventional Routing:</strong> Dùng template chung trong Program.cs nếu không dùng
                            attribute.</li>
                        <li><strong>Route Constraints:</strong> Áp dụng ràng buộc kiểu dữ liệu (vd:
                            <code>{id:int}</code>).</li>
                    </ol>
                    <div class="example">
                        <strong>Ví dụ:</strong> <code>/api/products/5</code> -> Khớp <code>{id:int}</code> -> Vào Action
                        Get(5).
                    </div>
                </div>
            </div>
        </section>

        <!-- Binding Section -->
        <section id="binding" class="diagram-section">
            <div class="section-header">
                <h3>2. Model Binding (Sequence Diagram)</h3>
                <p>Luồng dữ liệu từ HTTP Request vào đến tham số của Action.</p>
            </div>
            <div class="card-grid">
                <div class="card glass">
                    <div class="mermaid">
                        sequenceDiagram
                        autonumber
                        participant C as Client (Browser)
                        participant V as Value Providers
                        participant B as Model Binder
                        participant A as Action Parameter

                        C->>V: Gửi Request (Form, Query, Body)
                        V->>B: 1. Thu thập dữ liệu thô (Raw Data)
                        Note over B: 2. Type Conversion<br />(Chuyển đổi sang int, DateTime...)
                        B->>A: 3. Gán giá trị vào Parameter
                        Note right of A: 4. Binding Successful
                    </div>
                </div>
                <div class="explanation-card glass">
                    <h4>Chi tiết quy trình:</h4>
                    <ol>
                        <li><strong>Value Providers:</strong> Quét dữ liệu từ Form, Query String, Route, và Body.</li>
                        <li><strong>Type Conversion:</strong> Ép kiểu từ chuỗi văn bản sang kiểu dữ liệu C#.</li>
                        <li><strong>Parameter Mapping:</strong> Đổ dữ liệu đã xử lý vào tham số của hàm.</li>
                    </ol>
                    <div class="example">
                        <strong>Ví dụ:</strong> JSON <code>{"age": 25}</code> -> Model Binder ->
                        <code>int age = 25</code>.
                    </div>
                </div>
            </div>
        </section>

        <!-- Validation Section -->
        <section id="validation" class="diagram-section">
            <div class="section-header">
                <h3>3. Validation (Activity Diagram)</h3>
                <p>Vòng đời kiểm tra tính hợp lệ của dữ liệu thông qua Data Annotations.</p>
            </div>
            <div class="card-grid">
                <div class="card glass">
                    <div class="mermaid">
                        stateDiagram-v2
                        [*] --> Step1: 1. Nhận Model từ Binding
                        Step1 --> Step2: 2. Kiểm tra Data Annotations
                        note right of Step2: [Required], [Range], [Email]

                        Step2 --> Step3: 3. Cập nhật ModelState

                        state result_check <<choice>>
                            Step3 --> result_check

                            result_check --> Step4: 4. IsValid = True
                            result_check --> Step5: 4. IsValid = False

                            Step4 --> End: 5. Save Data / Execute Logic
                            Step5 --> Error: 5. Trả về View + Thông báo lỗi

                            End --> [*]
                            Error --> [*]
                    </div>
                </div>
                <div class="explanation-card glass">
                    <h4>Chi tiết quy trình:</h4>
                    <ol>
                        <li><strong>Data Annotations:</strong> Kiểm tra các quy tắc gắn trên Model.</li>
                        <li><strong>ModelState:</strong> Lưu trữ trạng thái và danh sách lỗi.</li>
                        <li><strong>Decision:</strong> Nếu hợp lệ thì thực hiện logic, nếu không thì báo lỗi.</li>
                    </ol>
                    <div class="example">
                        <strong>Ví dụ:</strong> <code>[Required]</code> cho Name -> Nếu để trống ->
                        <code>IsValid = false</code>.
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 ASP.NET Core Architecture Deep Dive - Binding, Routing & Validation</p>
        </div>
    </footer>
</body>

</html>