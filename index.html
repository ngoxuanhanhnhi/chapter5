<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASP.NET Core Architecture Flow</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            securityLevel: 'loose',
            fontFamily: 'Inter'
        });
    </script>
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <h1 class="logo">ASP.NET Core <span>Architecture</span></h1>
            <ul class="nav-links">
                <li><a href="#routing">Routing</a></li>
                <li><a href="#binding">Binding</a></li>
                <li><a href="#validation">Validation</a></li>
            </ul>
        </div>
    </nav>

    <header class="hero">
        <div class="container">
            <h2>Request Life Cycle</h2>
            <p>Visualizing the flow from JavaScript clients to ASP.NET Core Web API.</p>
        </div>
    </header>

    <main class="container">
        <!-- Routing Section -->
        <section id="routing" class="diagram-section">
            <div class="section-header">
                <h3>1. Routing Flow</h3>
                <p>How the system decides "where to go" when an HTTP request arrives.</p>
            </div>
            <div class="card glass">
                <div class="mermaid">
                    flowchart TD
                    Start([Start: URL Reception]) --> AttrCheck{"Attribute Routing?"}
                    AttrCheck -- "Yes" --> MatchAttr["Match [Route] on Controller/Action"]
                    AttrCheck -- "No" --> ConvCheck["Check Conventional Routing Templates"]

                    MatchAttr --> Constraints{"Match Constraints?"}
                    ConvCheck --> Constraints

                    Constraints -- "id:int, etc." --> Endpoint["Endpoint Selected"]
                    Constraints -- "No Match" --> NotFound([404 Not Found])

                    Endpoint --> Action["Execute Action Method"]

                    style Start fill:#3b82f6,color:#fff
                    style NotFound fill:#ef4444,color:#fff
                    style Action fill:#10b981,color:#fff
                    style AttrCheck fill:#f59e0b,color:#fff
                    style Constraints fill:#f59e0b,color:#fff
                </div>
            </div>
        </section>

        <!-- Binding Section -->
        <section id="binding" class="diagram-section">
            <div class="section-header">
                <h3>2. Model Binding Flow</h3>
                <p>Transferring data from HTTP requests into Action Method parameters.</p>
            </div>
            <div class="card glass">
                <div class="mermaid">
                    sequenceDiagram
                    participant C as Client
                    participant M as Middleware/Value Providers
                    participant B as Model Binder
                    participant A as Action Method Parameter

                    C->>M: Send HTTP Request (Form/Query/Body)
                    M->>B: Provide Raw Data (Value Providers)
                    Note over B: Type Conversion (int, DateTime, etc.)
                    B->>A: Map Data to Parameter
                    Note right of A: Binding Successful
                </div>
            </div>
        </section>

        <!-- Validation Section -->
        <section id="validation" class="diagram-section">
            <div class="section-header">
                <h3>3. Model Validation Flow</h3>
                <p>The lifecycle of ensuring data integrity using Data Annotations.</p>
            </div>
            <div class="card glass">
                <div class="mermaid">
                    stateDiagram-v2
                    [*] --> Received: Model from Binding
                    Received --> Checking: Scan Data Annotations
                    Checking --> ModelState: Populate ModelState

                    state result_check <<choice>>
                        ModelState --> result_check

                        result_check --> SaveData: IsValid = True
                        result_check --> ReturnView: IsValid = False

                        SaveData --> [*]: Success
                        ReturnView --> [*]: Return Errors to User

                        note right of Received: [Required], [Range], etc.
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 Chapter 07 - JavaScript Clients and ASP.NET Web API Request Flow</p>
        </div>
    </footer>
</body>

</html>